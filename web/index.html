
<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>FOREIGNERS IN CHINA</title>
	<meta name="description" content="FOREIGNERS IN CHINA">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel='stylesheet' href='./style.css'>
    <link rel="stylesheet" href="./swiper.min.css">
	<link rel="stylesheet" href="./animate.min.css">
	<style>
		@font-face {font-family: Helvetica;src: url(./Helvetica.ttf);}
		html, body {position: relative;height: 100%;}
		img{max-width: 100%;}
		iframe{width:100%;height:100%;position:absolute;left:0px;top: 0px;}

		.loading{width:100%;height:100%; position: absolute; z-index: 5; text-align:center; background: #f11a52;}.loading-center-absolute{position:absolute;left:46%;top:46%; margin-left: -30px;}.object{width:20px;height:20px;background-color:#FFF;float:left;margin-right:20px;-moz-border-radius:50% 50% 50% 50%;-webkit-border-radius:50% 50% 50% 50%;border-radius:50% 50% 50% 50%}#object_one{-webkit-animation:object_one 1.5s infinite;animation:object_one 1.5s infinite}#object_two{-webkit-animation:object_two 1.5s infinite;animation:object_two 1.5s infinite;-webkit-animation-delay:.25s;animation-delay:.25s}#object_three{-webkit-animation:object_three 1.5s infinite;animation:object_three 1.5s infinite;-webkit-animation-delay:.5s;animation-delay:.5s}@-webkit-keyframes object_one{75%{-webkit-transform:scale(0)}}@keyframes object_one{75%{transform:scale(0);-webkit-transform:scale(0)}}@-webkit-keyframes object_two{75%{-webkit-transform:scale(0)}}@keyframes object_two{75%{transform:scale(0);-webkit-transform:scale(0)}}@-webkit-keyframes object_three{75%{-webkit-transform:scale(0)}}@keyframes object_three{75%{transform:scale(0);-webkit-transform:scale(0)}}

	
		#progress{color:#fff; display:block; margin-top:15px;}
	</style>

</head>

<body>
<div class="loading">
	<div class="loading-center-absolute">
		<div class="object" id="object_one"></div>
		<div class="object" id="object_two"></div>
		<div class="object" id="object_three"></div>
		<div id="progress"></div>
	</div>
</div>

<div class="swiper-container" id="swiper-container1">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                    <div class="po" id="gifDiv-1"></div>
			</div>
		    <div class="swiper-slide" style="background:#efefef;">
					<h4 id="gifDiv-2"></h4>
			</div>
			<div class="swiper-slide" style="background:#efefef;">
				<div class="paper">
					<div class="ani" swiper-animate-effect="chevron">Who was the first foreigner in China reported by the press?</div>
					<div class="ani" swiper-animate-effect="chevron">What was the first promulgated management policy concerning foreigners in China?</div>
					<div class="ani" swiper-animate-effect="chevron">When did your hometown or its neighbouring cities/towns open up to foreigners?</div>
					<div class="ani" swiper-animate-effect="chevron">When was the first regulation permitting foreigners to enter and exit China promulgated?</div>
					<div class="ani" swiper-animate-effect="chevron">When was the first green card issued to the foreigner?</div>
					<div class="ani" swiper-animate-effect="chevron">When were the Qinghai-Tibet Plateau and the Himalayas first opened up to foreign mountain-climbers and expeditions?</div>
					<div class="ani" swiper-animate-effect="chevron">Since when are foreigners permitted to apply for IP protection for Online Information Communication?</div>
					<div class="ani" swiper-animate-effect="chevron">When did foreign exchange certificate stop circulating and become a collectable?</div>
					<div class="ani" swiper-animate-effect="chevron">Who was the first Chinese person reported by the press for his or her international marriage?</div>
					<div class="ani" swiper-animate-effect="chevron">When were the first regulations for foreign-owned medical establishment introduced?</div>
					<div class="ani" swiper-animate-effect="chevron">What were the first regulations for foreigners engaging in normal religious activities in China?</div>
					<div class="ani" swiper-animate-effect="chevron">When did the first film co-production take place in China?</div>
					<div class="ani" swiper-animate-effect="chevron">Who was the first foreign athlete granted with a green card?</div>
					<div class="ani" swiper-animate-effect="chevron">When did China formally promulgate the Regulations for Foreigners Taking up Employment in China?</div>
					<div class="ani" swiper-animate-effect="chevron">When did China become the world’s third-largest foreign-student importer?</div>
					<div class="ani" swiper-animate-effect="chevron">Do foreigners enjoy super-national treatment? Which fields in China are foreigners forbidden?</div>
				</div>
				<p class="con w80">The questions above take us through a critical stage experienced by the People’s Republic of China during its development: foreign economic and cultural communication in China. The regulatory policiesfor the stage have also undergone changes over seven decades and witnessed how China opened itself up.The questions are merely some of the classic examples. Systematic research and analysis of the development will take place later.</p>
			</div>
            <div class="swiper-slide" style="background:#efefef;">
			    <div class="swiper-container" id="swiper-container2">
					<div class="swiper-wrapper">
					   <div class="swiper-slide">
							<div id="gifDiv-3"></div>
						</div>
					</div>
			        <div class="swiper-scrollbar"></div>
				</div>
			</div>
			<div class="swiper-slide" style="background:#efefef;">
				 <div class="swiper-container" id="swiper-container3">
					<div class="swiper-wrapper">
					    <div class="swiper-slide">
							<div id="gifDiv-4"></div>
					    </div>
					</div>
			        <div class="swiper-scrollbar"></div>
				</div>
			</div>
			<div class="swiper-slide">
				  <div class="swiper-container" id="swiper-container4">
					<div class="swiper-wrapper">
					  <iframe id="iframe1" class="iframe" src='inner.html?r=0.1' frameborder='0' scrolling='yes' ></iframe>
		     	   </div>
			        <div class="swiper-scrollbar"></div>
				</div>
			</div>
			<div class="swiper-slide" style="background:#f11a53;">
				<div class="ani p20" swiper-animate-effect="fadeIn" id="gifDiv-5"></div>
			</div>
			<div class="swiper-slide" style="background:#151515;">
				  <div id="gifDiv-6"></div>
		    </div>
	</div>
</div>

	<input type="hidden" id="platform" value="PC">
	<script src='./d3.min.js'></script>
	<script src='./intersection-observer.js'></script>
	<script src='./stickyfill.min.js'></script>
	<script src='./scrollama.min.js'></script>
	<script src="./jquery-1.11.1.min.js"></script>
	<script src="./swiper.min.js"></script>
	<script src="./swiper.animate1.0.3.min.js"></script>
    <script>
	var mySwiper1;
	var mySwiper2;
	var mySwiper3;
	var mySwiper4;
	
	
    $(document).ready(function() {
	   
	   preload();
	  
	});
	
	/**
	* 根据分页以及终端类型，获取gif图片html
	*/
	function getGifHtml(pageIndex){
		let html = "";
		let p = $("#platform").val();

		if(pageIndex == 0){//第一屏
			if(p == "PC"){
				html = "<img id='gif-0' src=\"img/home-pc.gif\">";
			}else{
				html = "<img id='gif-0'  src=\"img/home.gif\">";
			}
		}else if(pageIndex == 1){//第二屏
			if(p == "PC"){
				html = "<img id='gif-1'  src=\"img/iosC.gif\">";
			}else{
				html = "<img id='gif-1'  src=\"img/iosC.gif\">";
			}
		}else if(pageIndex == 3){//第4屏
			if(p == "PC"){
				html = "<img id='gif-3'  src=\"img/DATA-PC.gif\">";
			}else{
				html = "<img id='gif-3'  src=\"img/DATA-ios.gif\">";
			}
		}else if(pageIndex == 4){//第5屏
			if(p == "PC"){
				html = "<img id='gif-4' src=\"img/pc-logo.gif\">";
			}else{
				html = "<img id='gif-4' src=\"img/LOGO-IOS.gif\">";9
			}
		}else if(pageIndex == 6){//第7屏
			if(p == "PC"){
				html = "<img id='gif-5'  src=\"img/wei-PC.gif\">";
			}else{
				html = "<img id='gif-5'  src=\"img/wei-IOS.gif\">";
			}
		}
		else if(pageIndex == 7){//第8屏
			if(p == "PC"){
				html = "<img id='gif-6'  src=\"img/name-pc1.jpg\">";
			}else{
				html = "<img id='gif-6'  src=\"img/name-ios.jpg\">";
			}
		}
		return html;
	}
	
	
	function initSwiper(){
		
	
	  mySwiper1 = new Swiper('#swiper-container1',{
		direction: 'vertical',
		effect : 'fade',
		pagination: {
		  el: '.swiper-pagination',
		  clickable: true,
		},on:{
			init: function(){
				swiperAnimateCache(this);
				swiperAnimate(this);
			  }, 
			    slideChangeTransitionEnd: function(){ 
				swiperAnimate(this);
			  },
				slideChange: function(){
				  console.log('改变了，activeIndex为'+this.activeIndex);
				  if(this.activeIndex == 0){
					$("#gifDiv-1").html(getGifHtml(this.activeIndex) + " <div class=\"arrow\"><img src=\"img/arrow.png\"></div>");
					  document.getElementById("gif-0").src = document.getElementById("gif-0").src;
				  }else if(this.activeIndex == 1){
					  $("#gifDiv-2").html(getGifHtml(this.activeIndex));
					  document.getElementById("gif-1").src = document.getElementById("gif-1").src;
				  }else if(this.activeIndex == 3){
					  $("#gifDiv-3").html(getGifHtml(this.activeIndex));
					  document.getElementById("gif-3").src = document.getElementById("gif-3").src;
					  
					  //初始化
					   mySwiper2 = new Swiper('#swiper-container2',{
						on:{
						  init: function(){
							swiperAnimateCache(this);
							swiperAnimate(this);
						  }, 
						  slideChangeTransitionEnd: function(){
							swiperAnimate(this);
						  } 
						},
						direction: 'vertical',
						nested:true,
						//resistanceRatio: 0,
						slidesPerView: 'auto',
						freeMode: true,
						scrollbar: {
						  el: '.swiper-scrollbar',
						},
					  });
					  
				  }else if(this.activeIndex == 4){
					  $("#gifDiv-4").html(getGifHtml(this.activeIndex));
					  document.getElementById("gif-4").src = document.getElementById("gif-4").src;
				  }else if(this.activeIndex == 6){
					  $("#gifDiv-5").html(getGifHtml(this.activeIndex));
					  document.getElementById("gif-5").src = document.getElementById("gif-5").src;
				  }else if(this.activeIndex == 7){
					  $("#gifDiv-6").html(getGifHtml(this.activeIndex));
					  document.getElementById("gif-6").src = document.getElementById("gif-6").src;
				  }
				},
				transitionEnd: function(){
				  if(this.activeIndex == 6 ){
					$("#iframe1").attr("src", "inner.html");
				  } 
				},
				slideChangeTransitionEnd: function(){
					swiperAnimate(this);
					console.log("===="+this.activeIndex );
				},
		 },
		
	  });
	 
	  mySwiper3 = new Swiper('#swiper-container3',{
		on:{
		  init: function(){
			swiperAnimateCache(this);
			swiperAnimate(this);
		  }, 
		  slideChangeTransitionEnd: function(){
			swiperAnimate(this);
		  } 
		},
		direction: 'vertical',
		nested:true,
		//resistanceRatio: 0,
		slidesPerView: 'auto',
		freeMode: true,
		scrollbar: {
		  el: '.swiper-scrollbar',
		},
	  });
	  mySwiper4 = new Swiper('#swiper-container4',{
		direction: 'vertical',
		nested:true,
		//resistanceRatio: 0,
		slidesPerView: 'auto',
		freeMode: true,
		scrollbar: {
		  el: '.swiper-scrollbar',
		},
	  });
	
	}
	
	
	function preloadImages(imageUrls, index = 0) {
	  if (imageUrls && imageUrls.length > index) {
		const img = new Image();
		img.onload = () => {
		  preloadImages(imageUrls, index + 1);
		};
		//img.crossOrigin = "";
		img.src = imageUrls[index];
		console.log(imageUrls[index] + "***  " + index);
		$("#progress").html(Math.round(100 * (index+1)/imageUrls.length) + "%");
	  }else{
		console.log("finished....");
		$("#progress").html("100%");
		initSwiper();
		$(".loading").fadeOut("fast", function(){
			//初始化第一个gif
			$("#gifDiv-1").html(getGifHtml(0) + " <div class=\"arrow\"><img src=\"img/arrow.png\"></div>");
		});
	  }
	}
	
	function preload(){
	  let arr = [];
	  if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {
		arr = ['img/wei-IOS.gif','img/DATA-ios.gif','img/iosC.gif','img/paper.png','img/home.gif','img/LOGO-IOS.gif'];
		$("#platform").val("MOB");
	  }else{
		arr = ['img/wei-PC.gif','img/DATA-PC.gif','img/pcC.gif','img/paper.png','img/home-pc.gif','img/pc-logo.gif'];
		$("#platform").val("PC");
	  } 
		
	  try{
	   preloadImages(arr);
	  }catch(e){
	   console.log(e);
	  }
	 }
	  
	 

  </script>
	 
    
</body>
</html>